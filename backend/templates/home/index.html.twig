{% extends 'base.html.twig' %}

{% block title %}Accueil{% endblock %}

{% block body %}
<div class="card">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 12px;">
        <div>
            {% if app.user %}
                <span class="muted">Bonjour, {{ app.user.displayName ?? app.user.userIdentifier }}</span>
            {% endif %}
        </div>
        <div style="display:flex; gap:8px;">
            <a class="btn" href="{{ path('app_story_index') }}">Liste des histoires</a>
            {% if app.user %}
                <a class="btn" href="{{ path('app_logout') }}">Se déconnecter</a>
            {% else %}
                <a class="btn" href="{{ path('app_login') }}">Se connecter</a>
                <a class="btn" href="{{ path('app_register') }}">Créer un compte</a>
            {% endif %}
        </div>
    </div>
    {% if topStory %}
        <section class="card" style="margin-bottom: 16px;">
            <h2>Histoire du mois</h2>
            <p>
                <a href="{{ path('app_story_show', { id: topStory.id }) }}">{{ topStory.title }}</a>
                — par {{ topStory.user ? topStory.user.displayName : 'Anonyme' }}
                — {{ topStory.createdAt ? topStory.createdAt|date('d/m/Y') : '' }}
                — Likes: {{ topStory.likesCount }}
            </p>
        </section>
    {% endif %}
    <h1>Histoires publiées</h1>

    {% if stories is defined and stories|length > 0 %}
        <ul class="list">
            {% for story in stories %}
                <li>
                    <div>
                        <a href="{{ path('app_story_show', { id: story.id }) }}">{{ story.title }}</a>
                        — par {{ story.user ? story.user.displayName : 'Anonyme' }}
                        — {{ story.createdAt ? story.createdAt|date('d/m/Y') : '' }}
                    </div>
                    <div class="muted">
                        {{ (story.content|slice(0, 220)) ~ (story.content|length > 220 ? '…' : '') | e('html') | nl2br }}
                    </div>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>Aucune histoire publiée pour l'instant.</p>
    {% endif %}
</div>
{% endblock %}
